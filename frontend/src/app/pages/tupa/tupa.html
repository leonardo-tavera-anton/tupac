<div class="tupa-dashboard">
  <header class="dashboard-header">
    <div class="header-content">
      <div class="muni-tag">GOBIERNO REGIONAL</div>
      <h1>Portal TUPA 2026</h1>
      <p>Plataforma Digital de Tr√°mites y Servicios</p>
    </div>
    <div class="header-actions">
      <button class="btn-action outline" (click)="verMisTramites()">üìÅ Mis Tr√°mites</button>
      <button class="btn-action logout" (click)="cerrarSesion()">üö™ Salir</button>
    </div>
  </header>

  <div class="main-layout">
    <aside class="sidebar-panel">
      <div class="filter-card sidebar-solid">
        <h3 class="panel-title">Realizar Consulta</h3>
        <div class="filter-group">
          <label class="input-label">üîç BUSCADOR DIRECTO</label>
          <input type="text" class="form-control modern-input" placeholder="Escriba nombre o c√≥digo..."
                 [(ngModel)]="terminoBusqueda" (input)="buscarPorTexto()" [disabled]="areaSeleccionada !== null">
        </div>
        <div class="divider-sidebar"><span>O FILTRE POR √ÅREAS</span></div>
        <div class="filter-group">
          <label class="input-label">üè¢ √ÅREA ADMINISTRATIVA</label>
          <select class="form-control modern-select" [ngModel]="areaSeleccionada" (ngModelChange)="seleccionarArea($event)" [disabled]="terminoBusqueda.length > 0">
            <option [ngValue]="null">-- Seleccione oficina --</option>
            <option *ngFor="let area of areas" [ngValue]="area">{{ area.nombre }}</option>
          </select>
        </div>
        <div class="filter-group">
          <label class="input-label">üìÑ TR√ÅMITE A REALIZAR</label>
          <select class="form-control modern-select" [ngModel]="tramiteSeleccionado" (ngModelChange)="seleccionarTramite($event)" [disabled]="!areaSeleccionada || terminoBusqueda.length > 0">
            <option [ngValue]="null">-- Seleccione tr√°mite --</option>
            <option *ngFor="let tramite of tramitesFiltrados" [ngValue]="tramite">{{ tramite.nombre_tramite }}</option>
          </select>
        </div>
        <div class="action-area" *ngIf="terminoBusqueda || areaSeleccionada">
          <button class="btn-nueva-consulta" (click)="resetearBusqueda()">‚Ü∫ NUEVA CONSULTA</button>
        </div>
      </div>
    </aside>

    <section class="results-view">
      <div class="full-detail card-solida animate-fade-in">
        <div class="content-wrapper empty-state-inner" *ngIf="!tramiteSeleccionado && !terminoBusqueda">
          <div class="icon-placeholder">üìã</div>
          <h3>Bienvenido al Portal TUPA</h3>
          <p>Utilice el panel izquierdo para buscar un tr√°mite espec√≠fico.</p>
        </div>

        <div class="content-wrapper search-preview-inner" *ngIf="terminoBusqueda && !tramiteSeleccionado">
          <h4 class="preview-title">Resultados para: "{{ terminoBusqueda }}"</h4>
          <div class="search-list">
            <div class="search-item-card" *ngFor="let res of resultadosBusqueda" (click)="seleccionarDesdeBusqueda(res)">
              <div class="item-info">
                <span class="badge-codigo" *ngIf="res.codigo_tupa">C√ìD: {{ res.codigo_tupa }}</span>
                <span class="item-name">{{ res.nombre_tramite }}</span>
              </div>
              <span class="arrow-go">‚ûî</span>
            </div>
          </div>
        </div>

        <div class="content-wrapper tramite-content" *ngIf="tramiteSeleccionado">
          <div class="detail-header">
            <div class="header-top-row">
              <span class="tupa-id">C√ìDIGO TUPA: {{ tramiteSeleccionado.codigo_tupa }}</span>
              <button class="btn-save-modern" (click)="guardarTramite(tramiteSeleccionado)">‚≠ê Guardar Selecci√≥n</button>
            </div>
            <h2 class="tramite-main-title">{{ tramiteSeleccionado.nombre_tramite }}</h2>
          </div>

          <div class="requisitos-grid">
            <div class="req-item" 
                 *ngFor="let req of tramiteSeleccionado.requisitos"
                 [class.selected]="itemsSeleccionados.has(req)"
                 (click)="toggleItem(req)">
              <div class="req-check">
                 <input type="checkbox" [checked]="itemsSeleccionados.has(req)">
              </div>
              <div class="req-body">
                <p class="req-text">{{ req.descripcion }}</p>
                <div class="req-footer">
                  <span class="req-cost">S/ {{ +req.importe | number:'1.2-2' }}</span>
                </div>
              </div>
            </div>
          </div>

          <div class="total-banner" [style.opacity]="itemsSeleccionados.size > 0 ? '1' : '0.5'">
            <div class="total-label">MONTO TOTAL SELECCIONADO</div>
            <div class="total-amount">S/ {{ calcularTotalSeleccionado() | number:'1.2-2' }}</div>
          </div>
        </div>
      </div>
    </section>
  </div>
</div>